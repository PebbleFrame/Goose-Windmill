angular.module("hack.authService",[]).factory("Auth",["$http","$location","$window",function(a,b,c){var d=function(b){return a({method:"POST",url:"/api/users/signin",data:b}).then(function(a){return a.data})},e=function(b){return a({method:"POST",url:"/api/users/signup",data:b}).then(function(a){return a.data})},f=function(){return!!c.localStorage.getItem("com.hack")},g=function(){c.localStorage.removeItem("com.hack"),c.localStorage.removeItem("hfUsers")};return{signin:d,signup:e,isAuth:f,signout:g}}]),angular.module("hack.followService",["angular-jwt"]).factory("Followers",["$http","$window","jwtHelper",function(a,b,c){var d=[],e=function(){var d,e=b.localStorage.getItem("com.hack");if(e&&(d=c.decodeToken(e).user),d){var f={username:d,following:h()};a({method:"POST",url:"/api/users/updateFollowing",data:f})}},f=function(a){var c=i();-1===c.indexOf(a)&&(c.push(a),b.localStorage.setItem("hfUsers",c)),e()},g=function(a){d=i(),d.indexOf(a)>-1&&(d.splice(d.indexOf(a),1),b.localStorage.setItem("hfUsers",d)),e()},h=function(){return b.localStorage.getItem("hfUsers")},i=function(){return h()||b.localStorage.setItem("hfUsers","pg,sama"),h().split(",")},j=function(){d=i()};return j(),{following:d,addFollower:f,removeFollower:g,localToArr:i,init:j}}]),angular.module("hack.linkService",[]).factory("Links",["$http","$interval","Followers",function(a,b,c){var d=[],e=[],f=function(){var b="/api/cache/topStories";return a({method:"GET",url:b}).then(function(a){e.splice(0,e.length),e.push.apply(e,a.data)})},g=function(b){var c="http://hn.algolia.com/api/v1/search_by_date?hitsPerPage=500&tagFilters=(story,comment),(",e=h(b);return c+=e+")",a({method:"GET",url:c}).then(function(a){angular.forEach(a.data.hits,function(a){null===a.title&&(a.isComment=!0)}),d.splice(0,d.length),d.push.apply(d,a.data.hits)})},h=function(a){for(var b=[],c=0;c<a.length;c++)b.push("author_"+a[c]);return b.join(",")},i=function(){g(c.following),b(function(){g(c.following),f()},3e5)};return i(),{getTopStories:f,getPersonalStories:g,personalStories:d,topStories:e}}]),angular.module("hack.auth",[]).controller("AuthController",["$scope","$window","$location","Auth","Followers",function(a,b,c,d,e){a.user={},a.newUser={},a.loggedIn=d.isAuth(),a.signin=function(){d.signin(a.user).then(function(c){b.localStorage.setItem("com.hack",c.token),b.localStorage.setItem("hfUsers",c.followers),e.init(),a.loggedIn=!0,a.user={}})["catch"](function(a){console.error(a)})},a.signup=function(){a.newUser.following=e.following.join(","),d.signup(a.newUser).then(function(c){b.localStorage.setItem("com.hack",c.token),a.loggedIn=!0,a.newUser={}})["catch"](function(a){console.error(a)})},a.logout=function(){d.signout(),a.loggedIn=!1}}]),angular.module("hack.currentlyFollowing",[]).controller("CurrentlyFollowingController",["$scope","Followers",function(a,b){a.currentlyFollowing=b.following,a.unfollow=function(a){b.removeFollower(a)},a.follow=function(c){b.addFollower(c),a.newFollow=""}}]),angular.module("hack.personal",[]).controller("PersonalController",["$scope","$window","Links","Followers",function(a,b,c,d){a.stories=c.personalStories,a.users=d.following,a.perPage=30,a.index=a.perPage;var e=function(){f()},f=function(){c.getPersonalStories(a.users)};e()}]),angular.module("hack.tabs",[]).controller("TabsController",["$scope","$window","Links","Followers",function(a,b,c,d){var e=b.location.hash.split("/")[1];e=e?e:"all",a.currentTab=e,a.angle=360,a.changeTab=function(b){a.currentTab=b},a.refreshs=function(){console.log("hereeeee"),c.getTopStories(),c.getPersonalStories(d.following),a.angle+=360}}]),angular.module("hack.topStories",[]).controller("TopStoriesController",["$scope","$window","Links","Followers","ezfb",function(a,b,c,d,e){angular.extend(a,c),a.stories=c.topStories,a.perPage=30,a.index=a.perPage,a.shareStory=function(a){e.ui({method:"share",href:a},function(a){})},a.currentlyFollowing=d.following,a.getData=function(){c.getTopStories()},a.addUser=function(a){d.addFollower(a)},a.getData()}]),angular.module("hack",["ngRoute","hack.topStories","hack.personal","hack.currentlyFollowing","hack.linkService","hack.authService","hack.followService","hack.tabs","hack.auth","ezfb"]).config(["ezfbProvider","$routeProvider","$httpProvider",function(a,b,c){a.setInitParams({appId:"836420059740734"}),b.when("/",{templateUrl:"app/topStories/topStories.html",controller:"TopStoriesController"}).when("/personal",{templateUrl:"app/personal/personal.html",controller:"PersonalController"}).otherwise({redirectTo:"/"})}]).filter("fromNow",function(){return function(a){return humanized_time_span(new Date(a))}}).filter("htmlsafe",["$sce",function(a){return function(b){return a.trustAsHtml(b)}}]).directive("rotate",function(){return{restrict:"A",link:function(a,b,c){a.$watch(c.degrees,function(a){var c="rotate("+a+"deg)";console.log(c),b.css({"-moz-transform":c,"-webkit-transform":c,"-o-transform":c,"-ms-transform":c})})}}});