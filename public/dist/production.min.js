angular.module("hack.authService",[]).factory("Auth",["$http","$location","$window",function(a,b,c){var d=function(b){return a({method:"POST",url:"/api/users/signin",data:b}).then(function(a){return a.data})},e=function(b){return a({method:"POST",url:"/api/users/signup",data:b}).then(function(a){return a.data})},f=function(){return!!c.localStorage.getItem("com.hack")},g=function(){c.localStorage.removeItem("com.hack"),c.localStorage.removeItem("hfUsers")};return{signin:d,signup:e,isAuth:f,signout:g}}]),angular.module("hack.followService",["angular-jwt"]).factory("Followers",["$http","$window","jwtHelper","Links",function(a,b,c,d){var e=[],f=function(){d.getPersonalStories(e),b.localStorage.setItem("hfUsers",e);var f,g=b.localStorage.getItem("com.hack");if(g&&(f=c.decodeToken(g).user),f){var h={username:f,following:e};a({method:"POST",url:"/api/users/updateFollowing",data:h})}},g=function(a){-1===e.indexOf(a)&&(e.push(a),f())},h=function(a){e.indexOf(a)>-1&&(e.splice(e.indexOf(a),1),f())},i=function(){return b.localStorage.getItem("hfUsers")},j=function(){if(i()){var a=i().split(",");return a}},k=function(a){var c=a||j();e.splice(0,e.length),e.push.apply(e,c),d.getPersonalStories(e),b.localStorage.setItem("hfUsers",e)};return k(),{following:e,addFollower:g,removeFollower:h,localToArr:j,init:k}}]),angular.module("hack.linkService",[]).factory("Links",["$http","$interval",function(a,b){var c=[],d=[],e=function(){var b="/api/cache/topStories";return a({method:"GET",url:b}).then(function(a){d.splice(0,d.length),d.push.apply(d,a.data)})},f=function(b){var d="http://hn.algolia.com/api/v1/search_by_date?hitsPerPage=500&tagFilters=(story,comment),(",e=g(b);return d+=e+")",a({method:"GET",url:d}).then(function(a){angular.forEach(a.data.hits,function(a){null===a.title&&(a.isComment=!0)}),c.splice(0,c.length),c.push.apply(c,a.data.hits)})},g=function(a){for(var b=[],c=0;c<a.length;c++)b.push("author_"+a[c]);return b.join(",")},h=function(){b(function(){e()},3e5)};return h(),{getTopStories:e,getPersonalStories:f,personalStories:c,topStories:d}}]),angular.module("hack.auth",[]).controller("AuthController",["$scope","$window","$location","Auth","Followers",function(a,b,c,d,e){a.user={},a.newUser={},a.loggedIn=d.isAuth(),a.signin=function(){d.signin(a.user).then(function(c){b.localStorage.setItem("com.hack",c.token),b.localStorage.setItem("hfUsers",c.followers),e.init(c.followers.split(",")),a.loggedIn=!0,a.user={}})["catch"](function(a){console.error(a)})},a.signup=function(){a.newUser.following=e.following.join(","),d.signup(a.newUser).then(function(c){b.localStorage.setItem("com.hack",c.token),a.loggedIn=!0,a.newUser={}})["catch"](function(a){console.error(a)})},a.logout=function(){e.init(),d.signout(),a.loggedIn=!1}}]),angular.module("hack.currentlyFollowing",[]).controller("CurrentlyFollowingController",["$scope","Followers",function(a,b){a.currentlyFollowing=b.following,a.unfollow=function(c){b.removeFollower(c),a.currentlyFollowing=b.following},a.follow=function(c){b.addFollower(c),a.newFollow="",a.currentlyFollowing=b.following}}]),angular.module("hack.personal",[]).controller("PersonalController",["$scope","$window","Links","Followers",function(a,b,c,d){a.stories=c.personalStories,a.users=d.following,a.perPage=30,a.index=a.perPage;var e=function(){f()},f=function(){c.getPersonalStories(a.users)};e()}]),angular.module("hack.tabs",[]).controller("TabsController",["$scope","$window","Links","Followers",function(a,b,c,d){var e=b.location.hash.split("/")[1];e=e?e:"all",a.currentTab=e,a.angle=360,a.changeTab=function(b){a.currentTab=b},a.refreshs=function(){console.log("hereeeee"),c.getTopStories(),c.getPersonalStories(d.following),a.angle+=360}}]),angular.module("hack.topStories",[]).controller("TopStoriesController",["$scope","$window","Links","Followers",function(a,b,c,d){angular.extend(a,c),a.stories=c.topStories,a.perPage=30,a.index=a.perPage,a.currentlyFollowing=d.following,a.getData=function(){c.getTopStories()},a.addUser=function(a){d.addFollower(a)},a.getData()}]),angular.module("hack",["ngRoute","hack.topStories","hack.personal","hack.currentlyFollowing","hack.linkService","hack.authService","hack.followService","hack.tabs","hack.auth"]).config(["$routeProvider","$httpProvider",function(a,b){a.when("/",{templateUrl:"app/topStories/topStories.html",controller:"TopStoriesController"}).when("/personal",{templateUrl:"app/personal/personal.html",controller:"PersonalController"}).otherwise({redirectTo:"/"}),b.interceptors.push(["$q","$location","$window",function(a,b,c){return{request:function(a){return-1===a.url.indexOf("algolia")&&(a.headers=a.headers||{},c.localStorage.getItem("com.hack")&&(a.headers.Authorization="Bearer "+c.localStorage.getItem("com.hack"),a.headers["x-access-token"]=c.localStorage.getItem("com.hack"))),a},responseError:function(c){return(401===c.status||403===c.status)&&b.path("/signin"),a.reject(c)}}}])}]).filter("fromNow",function(){return function(a){return humanized_time_span(new Date(a))}}).filter("htmlsafe",["$sce",function(a){return function(b){return a.trustAsHtml(b)}}]).directive("rotate",function(){return{restrict:"A",link:function(a,b,c){a.$watch(c.degrees,function(a){var c="rotate("+a+"deg)";console.log(c),b.css({"-moz-transform":c,"-webkit-transform":c,"-o-transform":c,"-ms-transform":c})})}}});